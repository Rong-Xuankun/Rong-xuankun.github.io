# C语言

**清除scanf的缓存区：**

* `fflush(); fflush(stdin); fflush(stdout);`
* 使用`getchar()`
* `scanf("%1c", &a)`来限制读取一个字符



**解决内存泄漏：**

当我们使用 C 语言的 malloc 进行变量的内存动态分配后，务必记得回收内存，否则会导致内存泄漏。

内存泄漏往往是由于 malloc 和 free 没有成对出现。当代码量较大时，内存泄漏问题往往难以通过肉眼检查，需要借助更为高效的工具完成对内存泄漏的检测。

目前最为流行的内存泄漏检测工具是 valgrind。

valgrind 包括如下一些工具：

- Memcheck：这是 valgrind 应用最广泛的工具，也是默认执行的工具，一个重量级的内存检查器，能够发现开发中绝大多数内存错误使用情况，比如：使用未初始化的内存，使用已经释放了的内存，内存访问越界等。这也是本文将重点介绍的部分。
- Callgrind：它主要用来检查程序中函数调用过程中出现的问题。
- Cachegrind：它主要用来检查程序中缓存使用出现的问题。
- Helgrind：它主要用来检查多线程程序中出现的竞争问题。
- Massif：它主要用来检查程序中堆栈使用中出现的问题。
- Extension：可以利用 core 提供的功能，自己编写特定的内存调试工具。



__计算质数：__

```c
for(int i = 0; i * i < n; i++)
{
  ………………
}
```







**strncpy：**

对不安全的数据类型系统地使用安全的操作。通过把strcpy更换为有大小限制的字符串复制操作strncpy，就可以使上面的C代码段得到保护。



**const：**

源字符串参数用`const`修饰，防止修改源字符串。

`const`是一个C语言（ANSI C）的关键字，具有着举足轻重的地位。它限定一个变量不允许被改变，产生静态作用。使用`const`在一定程度上可以提高程序的安全性和可靠性。另外，在观看别人代码的时候，清晰理解`const`所起的作用，对理解对方的程序也有一定帮助。



**assert:**

`assert`宏的原型定义在`<assert.h>`中，其作用是如果它的条件返回错误，则终止程序执行。

编写代码时，我们总是会做出一些假设，断言就是用于在代码中捕捉这些假设，可以将断言看作是异常处理的一种高级形式。断言表示为一些布尔表达式，程序员相信在程序中的某个特定点该表达式值为真。可以在任何时候启用和禁用断言验证，因此可以在测试时启用断言，而在部署是禁用断言。同样，程序投入运行后，最终用户在遇到问题时可以重新启用断言。



**calloc和malloc:**

`calloc`与`malloc`主要有两点不同：

- `calloc`函数申请的内存空间是经过初始化的，全部被设成了`0`，而不是像`malloc`所申请的空间那样都是未经初始化的。
- `calloc`函数适合为数组申请空间，我们可以将第二个参数设置为数组元素的空间大小，将第一个参数设置为数组的元素数量。



**memset:**

借助`memset`来快速地将一个数组中的所有元素都初始化为 0。

```c
#include <string.h>
int a[100];
memset(a, 0, sizeof(a));
memset(a, -1, sizeof(a));
memset(a, 0x3f, sizeof(a));
......
```



