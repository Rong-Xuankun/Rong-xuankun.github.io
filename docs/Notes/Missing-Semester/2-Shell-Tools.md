# Shell工具和脚本

> <https://missing-semester-cn.github.io/2020/shell-tools/>

## Shell脚本

到目前为止，我们已经学习来如何在`shell`中执行命令，并使用管道将命令组合使用。但是，很多情况下我们需要执行一系列的操作并使用条件或循环这样的控制流。

`shell`脚本是一种更加复杂度的工具。

大多数`shell`都有自己的一套脚本语言，包括变量、控制流和自己的语法。`shell`脚本与其他脚本语言不同之处在于，`shell`脚本针对`shell`所从事的相关工作进行来优化。因此，创建命令流程（`pipelines`）、将结果保存到文件、从标准输入中读取输入，这些都是`shell`脚本中的原生操作，这让它比通用的脚本语言更易用。本节中，我们会专注于`bash`脚本，因为它最流行，应用更为广泛。

在bash中为变量赋值的语法是`foo=bar`，访问变量中存储的数值，其语法为`$foo`。需要注意的是，`foo = bar`（使用空格隔开）是不能正确工作的，因为解释器会调用程序`foo`并将`=`和`bar`作为参数。总的来说，在`shell`脚本中使用空格会起到分割参数的作用，有时候可能会造成混淆，请务必多加检查。

`Bash`中的字符串通过`'`和`"`分隔符来定义，但是它们的含义并不相同。以`'`定义的字符串为原义字符串，其中的变量不会被转义，而`"`定义的字符串会将变量值进行替换。

```
rxk@qiaoyiyudeMacBook-Air ~ % foo=bar
rxk@qiaoyiyudeMacBook-Air ~ % echo "$foo"   # 打印 bar
bar
rxk@qiaoyiyudeMacBook-Air ~ % echo '$bar'   # 打印 $foo
$bar
```

和其他大多数的编程语言一样，`bash`也支持`if`,`case`, `while`和`for`这些控制流关键字。同样地，`bash`也支持函数，它可以接受参数并基于参数进行操作。下面这个函数是一个例子，它会创建一个文件夹并使用`cd`进入该文件夹。

```
mcd () {
    mkdir -p "$1"
    cd "$1"
}
```

这里`$1`是脚本的第一个参数。与其他脚本语言不同的是，`bash`使用了很多特殊的变量来表示参数、错误代码和相关变量。下面是列举来其中一些变量，更完整的列表可以参考[这个网站](https://tldp.org/LDP/abs/html/special-chars.html)

